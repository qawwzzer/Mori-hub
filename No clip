-- LocalScript: ToggleUpsideDown.lua

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- สร้าง GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "UpsideDownToggleGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- ปุ่ม Toggle
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 100, 0, 30)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 100
toggleButton.Text = "(OFF)"
toggleButton.Parent = screenGui

-- ติดตามสถานะเปิด/ปิด
local isActive = false

-- ฟังก์ชันวาร์ปลงพื้นและกลับหัว (เท้าพอดีติดพื้น)
local function activateUpsideDown()
	character = player.Character or player.CharacterAdded:Wait()
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")

	local depth = 5.5 -- ปรัความลึกลงให้เท้าติดพื้นพอดี
	local newPosition = humanoidRootPart.Position - Vector3.new(0, depth, 0)
	local newCFrame = CFrame.new(newPosition) * CFrame.Angles(math.rad(180), 0, 0)

	humanoidRootPart.Anchored = true
	humanoidRootPart.CFrame = newCFrame
end

-- ฟังก์ชันรีเซ็ตกลับสู่ท่าปกติ
local function resetToNormal()
	character = player.Character or player.CharacterAdded:Wait()
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")

	humanoidRootPart.Anchored = false
	-- ยืนตรงและลอยขึ้นเล็กน้อยเพื่อไม่ติดพื้น
	local position = humanoidRootPart.Position + Vector3.new(0, 5, 0)
	humanoidRootPart.CFrame = CFrame.new(position)
end

-- กดปุ่ม toggle
toggleButton.MouseButton1Click:Connect(function()
	isActive = not isActive

	if isActive then
		toggleButton.Text = "ปิดฟังก์ชัน (ON)"
		activateUpsideDown()
	else
		toggleButton.Text = "เปิดฟังก์ชัน (OFF)"
		resetToNormal()
	end
end)

-- รีเซ็ตตัวละคร: คืนค่าเริ่มต้น
player.CharacterAdded:Connect(function(char)
	character = char
	local hrp = character:WaitForChild("HumanoidRootPart")
	task.wait(0.1)
	hrp.Anchored = false
	isActive = false
	toggleButton.Text = "เปิดฟังก์ชัน (OFF)"
end)
