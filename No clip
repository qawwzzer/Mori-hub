local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "UpsideDownToggleGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 150, 0, 40)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 20
toggleButton.Text = "เปิดฟังก์ชัน (OFF)"
toggleButton.Parent = screenGui

local isActive = false

-- กลับหัวและมุดดิน (หมุนแค่ HumanoidRootPart)
local function rotateUpsideDown()
	character = player.Character or player.CharacterAdded:Wait()
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")

	local depth = 5.5
	local newPosition = humanoidRootPart.Position - Vector3.new(0, depth, 0)
	local newCFrame = CFrame.new(newPosition) * CFrame.Angles(math.rad(180), 0, 0)

	humanoidRootPart.Anchored = true
	humanoidRootPart.CFrame = newCFrame
end

-- คืนค่าปกติ
local function resetRotation()
	character = player.Character or player.CharacterAdded:Wait()
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")

	local position = humanoidRootPart.Position + Vector3.new(0, 5, 0)
	humanoidRootPart.CFrame = CFrame.new(position)
	humanoidRootPart.Anchored = false
end

-- Toggle
toggleButton.MouseButton1Click:Connect(function()
	isActive = not isActive

	if isActive then
		toggleButton.Text = "ปิดฟังก์ชัน (ON)"
		rotateUpsideDown()
	else
		toggleButton.Text = "เปิดฟังก์ชัน (OFF)"
		resetRotation()
	end
end)

-- Reset ตัวละคร
player.CharacterAdded:Connect(function(char)
	character = char
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")
	isActive = false
	toggleButton.Text = "เปิดฟังก์ชัน (OFF)"
end)
