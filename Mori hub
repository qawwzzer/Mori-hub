local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- CONFIG
local aimbotEnabled = false
local fovEnabled = true
local smoothness = 0.2
local fovRadius = 120
local aimPart = "Head"
local currentTarget = nil
local highlightBox = nil

-- FOV Drawing
local fovCircle = Drawing.new("Circle")
fovCircle.Color = Color3.fromRGB(255, 0, 0)
fovCircle.Thickness = 1
fovCircle.Filled = false
fovCircle.Radius = fovRadius
fovCircle.Visible = fovEnabled

-- GUI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "MORI HUB AIMBOT"
gui.ResetOnSpawn = false
gui.Parent = game.CoreGui

-- MENU Button (Draggable)
local menuToggle = Instance.new("TextButton")
menuToggle.Text = "MENU"
menuToggle.Size = UDim2.new(0, 80, 0, 30)
menuToggle.Position = UDim2.new(0, 20, 0, 100)
menuToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
menuToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
menuToggle.Draggable = true
menuToggle.Active = true
menuToggle.Parent = gui

-- MainFrame (UI เมนู)
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 240, 0, 240)
MainFrame.Position = UDim2.new(0, 110, 0, 100)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = false
MainFrame.Parent = gui
Instance.new("UICorner", MainFrame)

-- Title Label
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "MORI HUB AIMBOT"
Title.TextColor3 = Color3.fromRGB(0, 255, 255)
Title.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Title.TextScaled = true

-- Aimbot Toggle Button
local AimbotToggle = Instance.new("TextButton", MainFrame)
AimbotToggle.Size = UDim2.new(1, -20, 0, 30)
AimbotToggle.Position = UDim2.new(0, 10, 0, 40)
AimbotToggle.Text = "Aimbot: OFF"
AimbotToggle.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
AimbotToggle.TextColor3 = Color3.fromRGB(255, 255, 255)

-- FOV Toggle Button
local FOVToggle = Instance.new("TextButton", MainFrame)
FOVToggle.Size = UDim2.new(1, -20, 0, 30)
FOVToggle.Position = UDim2.new(0, 10, 0, 80)
FOVToggle.Text = "FOV: ON"
FOVToggle.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
FOVToggle.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Smoothness
local SmoothLabel = Instance.new("TextLabel", MainFrame)
SmoothLabel.Size = UDim2.new(1, -20, 0, 20)
SmoothLabel.Position = UDim2.new(0, 10, 0, 120)
SmoothLabel.Text = "Smoothness:"
SmoothLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SmoothLabel.BackgroundTransparency = 1

local SmoothBox = Instance.new("TextBox", MainFrame)
SmoothBox.Size = UDim2.new(1, -20, 0, 30)
SmoothBox.Position = UDim2.new(0, 10, 0, 140)
SmoothBox.Text = tostring(smoothness)
SmoothBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
SmoothBox.TextColor3 = Color3.fromRGB(255, 255, 255)
SmoothBox.ClearTextOnFocus = false

-- FOV Input
local FOVLabel = Instance.new("TextLabel", MainFrame)
FOVLabel.Size = UDim2.new(1, -20, 0, 20)
FOVLabel.Position = UDim2.new(0, 10, 0, 175)
FOVLabel.Text = "FOV Radius:"
FOVLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FOVLabel.BackgroundTransparency = 1

local FOVBox = Instance.new("TextBox", MainFrame)
FOVBox.Size = UDim2.new(1, -20, 0, 30)
FOVBox.Position = UDim2.new(0, 10, 0, 195)
FOVBox.Text = tostring(fovRadius)
FOVBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
FOVBox.TextColor3 = Color3.fromRGB(255, 255, 255)
FOVBox.ClearTextOnFocus = false

-- Menu Toggle
menuToggle.MouseButton1Click:Connect(function()
	MainFrame.Visible = not MainFrame.Visible
end)

AimbotToggle.MouseButton1Click:Connect(function()
	aimbotEnabled = not aimbotEnabled
	AimbotToggle.Text = "Aimbot: " .. (aimbotEnabled and "ON" or "OFF")
end)

FOVToggle.MouseButton1Click:Connect(function()
	fovEnabled = not fovEnabled
	FOVToggle.Text = "FOV: " .. (fovEnabled and "ON" or "OFF")
	fovCircle.Visible = fovEnabled
end)

SmoothBox.FocusLost:Connect(function()
	local val = tonumber(SmoothBox.Text)
	if val then
		smoothness = math.clamp(val, 0, 1)
	end
end)

FOVBox.FocusLost:Connect(function()
	local val = tonumber(FOVBox.Text)
	if val then
		fovRadius = math.clamp(val, 20, 500)
		fovCircle.Radius = fovRadius
	end
end)

-- Highlight Box
local function createHighlight(targetModel)
	if highlightBox then highlightBox:Destroy() end
	local box = Instance.new("Highlight")
	box.FillColor = Color3.fromRGB(255, 255, 255)
	box.FillTransparency = 0.7
	box.OutlineTransparency = 1
	box.Adornee = targetModel
	box.Parent = game.CoreGui
	highlightBox = box
end

-- Target Finder
local function getClosestTarget()
	local closest, shortestDistance = nil, math.huge

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(aimPart) then
			local part = player.Character[aimPart]
			local pos, visible = Camera:WorldToViewportPoint(part.Position)
			local screenPos = Vector2.new(pos.X, pos.Y)
			local dist = (screenPos - Camera.ViewportSize / 2).Magnitude

			if visible and dist < shortestDistance and (not fovEnabled or dist <= fovRadius) then
				shortestDistance = dist
				closest = player
			end
		end
	end

	return closest
end

-- Aimbot Loop
RunService.RenderStepped:Connect(function()
	fovCircle.Position = Camera.ViewportSize / 2

	if aimbotEnabled then
		local targetPlayer = getClosestTarget()
		if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild(aimPart) then
			local part = targetPlayer.Character[aimPart]
			local prediction = part.Position + part.Velocity * 0.07
			local origin = Camera.CFrame.Position
			local direction = (prediction - origin).Unit
			local newCFrame = CFrame.new(origin, origin + direction)

			Camera.CFrame = Camera.CFrame:Lerp(newCFrame, smoothness)
			createHighlight(targetPlayer.Character)
			currentTarget = targetPlayer
		else
			if highlightBox then
				highlightBox:Destroy()
				highlightBox = nil
			end
			currentTarget = nil
		end
	end
end)

-- ฟื้น UI เมื่อตาย
LocalPlayer.CharacterAdded:Connect(function()
	task.wait(1)
	gui.Parent = game.CoreGui
end)
